
<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/konva@2.4.2/konva.min.js"></script>
  <meta charset="utf-8">
  <title>Actuation Test</title>
  <meta http-equiv="refresh" content="60">
</head>

<body>
    <style>
            body {
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: #ffccff;
            }
    </style>
    <center><h1 id="instructions"> Scroll Using Arrows</h1></center>
    <div id="container"></div>
    <script>

        document.onkeydown = checkKey;
        var index = 1;
        var data = getData();

        function changeBackground(h, s, l) {
            var h = h.toString();
            var s = s.toString();
            var l = l.toString();
            var color = 'hsl(' + h + ',' + s +'%,' + l + '%)';

            document.body.style.backgroundColor = color;
        }
        
        function makeline(activity, intervals, h, s, l) {
            var width = window.innerWidth;
            var step = window.innerWidth/(intervals-1);
            var a = activity;
            var i = intervals;
            var amp = 120;
            var points = [];
            var h = h.toString();
            var s = s.toString();
            var l = l.toString();
            var color = 'hsl(' + h + ',' + s +'%,' + l + '%)';

            for (x = 0; x < i; x++) {
                if (x == 0) {
                    var p_x = -10;
                    var p_y = amp*a*Math.random()*Math.sin(x*Math.PI/(i-1)); 
                    points.push(p_x);
                    points.push(p_y);
                } 
                
                else if (x == i-1) {
                    var p_x = width+10;
                    var p_y = amp*a*Math.random()*Math.sin(x*Math.PI/(i-1));
                    points.push(p_x);
                    points.push(p_y);
                } 
                
                else {
                    var p_x = 0+x*step;
                    var p_y = amp*a*Math.random()*Math.sin(x*Math.PI/(i-1));
                    points.push(p_x);
                    points.push(p_y);
                }
            }

            var line = new Konva.Line({
                points: points,
                stroke: color,
                strokeWidth: 4,
                lineCap: 'round',
                lineJoin: 'round',
                tension : 0.5
                });
            
            return line;
        }
        
        function setStage(){
            var width = window.innerWidth;
            var height = window.innerHeight;
            var stage = new Konva.Stage({
                container: 'container',
                width: width,
                height: height
                });
                
            var layer = new Konva.Layer();
            
            for (l = 0; l < 20; l++) {
                var y = makeline(1, 7, 220, 50, 50)
                y.move({
                    x : 0,
                    y : 25 + 50*l
                    });
                layer.add(y);
            }
            stage.add(layer);
        }

        function formatData(){

            console.log(data)

            if (index >= 1){
                var point = data[index];
            }

            else {
                var point = data[1];
            }

            var dt = point[0];
            var tweet = point[1];
            var uv = point[2];
            var cc = point[3];

            var b_d = 200 + 150 * uv;
            var b_s = 10 + 90 * Math.random();
            var b_b = 60 + 40 * Math.random();

            var l_d = 60 + 110 * uv;
            var l_s = 40 + 60 * Math.random();
            var l_b = 100;

            var formatData = [dt, tweet, b_d, b_s, b_b, l_d, l_s, l_b];
            return formatData;
        }

        function checkKey(e) {

            e = e || window.event;

            if (e.keyCode == '40') {
                var coeff = formatData();
                setStage();
                changeBackground(320, 70, 20);
                instructions.innerText = coeff[0];
                console.log(coeff);

            }
            else if (e.keyCode == '38') {
                console.log("up");
                setStage();
                changeBackground(320, 70, 20);
                instructions.innerText = "";
            }
        }       
        
        function processData(allText) {
            var allTextLines = allText.split(/\r\n|\n/);
            var headers = allTextLines[0].split(',');
            var lines = [];
            
            for (var i=1; i<allTextLines.length; i++) {
                var data = allTextLines[i].split(',');
                if (data.length == headers.length) {
                    var tarr = [];
                    
                    for (var j=0; j<headers.length; j++) {
                        tarr.push(data[j]);
                    }
                    lines.push(tarr);
                }
            }
            return lines;
        }

        function getData(){
            var xmlhttp;
            
            if (window.XMLHttpRequest) {
                xmlhttp = new XMLHttpRequest();
            }           
            
            else {               
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");               
            }
            
            xmlhttp.onreadystatechange = function () {               
                if (xmlhttp.readyState == 4) {                   
                    var lines = xmlhttp.responseText;    
                    x = processData(lines);  
                    return x;
                }               
            }

            xmlhttp.open("GET", "data.txt", true);
            xmlhttp.send();    
        }

    </script>
</body>
</html>