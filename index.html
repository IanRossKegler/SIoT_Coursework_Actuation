
<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/konva@2.4.2/konva.min.js"></script>
  <meta charset="utf-8">
  <title>Actuation Test</title>
  <meta http-equiv="refresh" content="60">
</head>

<body>
    <style>
            body {
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: #ffccff;
            }
    </style>
    <center><h1 id="instructions"> Scroll Using Arrows</h1></center>
    <div id="container"></div>
    <script>
        function change_background(h, s, l) {
            var h = h.toString();
            var s = s.toString();
            var l = l.toString();
            var color = 'hsl(' + h + ',' + s +'%,' + l + '%)';

            document.body.style.backgroundColor = color;
        }
        
        function makeline(activity, intervals, h, s, l) {
            var width = window.innerWidth;
            var step = window.innerWidth/(intervals-1);
            var a = activity;
            var i = intervals;
            var amp = 120;
            var points = [];
            var h = h.toString();
            var s = s.toString();
            var l = l.toString();
            var color = 'hsl(' + h + ',' + s +'%,' + l + '%)';

            for (x = 0; x < i; x++) {
                if (x == 0) {
                    var p_x = -10;
                    var p_y = amp*a*Math.random()*Math.sin(x*Math.PI/(i-1)); 
                    points.push(p_x);
                    points.push(p_y);
                } 
                
                else if (x == i-1) {
                    var p_x = width+10;
                    var p_y = amp*a*Math.random()*Math.sin(x*Math.PI/(i-1));
                    points.push(p_x);
                    points.push(p_y);
                } 
                
                else {
                    var p_x = 0+x*step;
                    var p_y = amp*a*Math.random()*Math.sin(x*Math.PI/(i-1));
                    points.push(p_x);
                    points.push(p_y);
                }
            }

            var line = new Konva.Line({
                points: points,
                stroke: color,
                strokeWidth: 4,
                lineCap: 'round',
                lineJoin: 'round',
                tension : 0.5
                });
            
            return line;
        }
        
        function set_stage(){
            var width = window.innerWidth;
            var height = window.innerHeight;
            var stage = new Konva.Stage({
                container: 'container',
                width: width,
                height: height
                });
                
            var layer = new Konva.Layer();
            
            for (l = 0; l < 20; l++) {
                var y = makeline(1, 7, 220, 50, 50)
                y.move({
                    x : 0,
                    y : 25 + 50*l
                    });
                layer.add(y);
            }
            stage.add(layer);
        }

        function checkKey(e) {

            e = e || window.event;

            if (e.keyCode == '40') {
                console.log("down");
                set_stage();
                change_background(320, 70, 20);
                instructions.innerText = "";

            }
            else if (e.keyCode == '38') {
                console.log("up");
                set_stage();
                change_background(320, 70, 20);
                instructions.innerText = "";
            }
        }       
        
        function processData(allText) {
            var allTextLines = allText.split(/\r\n|\n/);
            var dataLength = allTextLines[0].length;
            var lines = [];
            
            for (var i=0; i<allTextLines.length; i++) {
                var data = allTextLines[i].split(',');
                var tarr = [];
                
                for (var j=0; j<dataLength; j++) {
                    tarr.push(data[j]);
                }
                lines.push(tarr);
            }
            console.log(lines[0]);
        }

        function getData(){
            var xmlhttp;
            
            if (window.XMLHttpRequest) {
                xmlhttp = new XMLHttpRequest();
            }           
            
            else {               
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");               
            }
            
            xmlhttp.onreadystatechange = function () {               
                if (xmlhttp.readyState == 4) {                   
                    var lines = xmlhttp.responseText;
                    processData(lines);

                }               
            }

            xmlhttp.open("GET", "data.txt", true);
            xmlhttp.send();    
        }

        document.onkeydown = checkKey;
        getData();
    </script>
</body>
</html>